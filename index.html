<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>أسعار الشاشات والبطاريات وقطع الغيار البارون 07719813722-07507946930</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo&display=swap');
  body { font-family: 'Cairo', sans-serif; margin: 0; padding: 0; background: #f0f4f8; color: #222; transition: background-color 0.3s ease; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
  header { background: linear-gradient(90deg, #1976d2, #42a5f5); color: white; text-align: center; padding: 20px 10px; position: relative; box-shadow: 0 3px 8px rgb(25 118 210 / 0.4); }
  header h1 { margin: 0; font-weight: 700; font-size: 1.8rem; letter-spacing: 1px; }
  .admin-dot { position: absolute; left: 12px; top: 20px; width: 20px; height: 20px; background: #121212; border-radius: 50%; cursor: pointer; box-shadow: 0 0 8px #000; transition: transform 0.25s ease, box-shadow 0.25s ease; }
  .admin-dot:hover { transform: scale(1.2); box-shadow: 0 0 15px #2196f3; }
  .container { max-width: 600px; margin: 30px auto 50px; padding: 15px 25px; background: white; border-radius: 14px; box-shadow: 0 8px 30px rgb(0 0 0 / 0.1); transition: box-shadow 0.3s ease; }
  .container:focus-within { box-shadow: 0 10px 40px rgb(33 150 243 / 0.35); }
  label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 1.1rem; color: #1976d2; }
  select, input[type="text"], input[type="number"] { width: 100%; padding: 14px 18px; font-size: 17px; margin-bottom: 20px; border-radius: 12px; border: 2px solid #ddd; outline-offset: 2px; outline-color: transparent; box-sizing: border-box; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
  select:hover, input[type="text"]:hover, input[type="number"]:hover,
  select:focus, input[type="text"]:focus, input[type="number"]:focus {
    border-color: #2196f3; box-shadow: 0 0 12px #90caf9; outline-color: #2196f3;
  }
  #searchInput { margin-top: -10px; margin-bottom: 25px; }
  .list { background: #f9fbff; border-radius: 12px; max-height: 420px; overflow-y: auto; box-shadow: inset 0 0 10px rgb(33 150 243 / 0.1); padding: 15px; font-size: 16px; }
  .item { padding: 14px 20px; border-bottom: 1px solid #dde7f2; display: flex; justify-content: space-between; align-items: center; color: #333; font-weight: 600; cursor: default; user-select: none; transition: background-color 0.25s ease; }
  .item:last-child { border-bottom: none; }
  .item:hover { background-color: #e3f2fd; }
  .item .price { color: #1976d2; font-weight: 700; }
  button { background: #2196f3; color: white; border: none; font-weight: 600; font-size: 17px; padding: 14px 25px; border-radius: 14px; cursor: pointer; transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease; box-shadow: 0 4px 15px rgb(33 150 243 / 0.4); user-select: none; margin-top: 10px; }
  button:hover { background-color: #1976d2; box-shadow: 0 6px 25px rgb(25 118 210 / 0.6); transform: translateY(-2px); }
  button:active { transform: translateY(0); box-shadow: 0 3px 10px rgb(25 118 210 / 0.5); }
  button.btn-back { background: #777; box-shadow: 0 4px 15px rgb(117 117 117 / 0.4); }
  button.btn-back:hover { background: #555; box-shadow: 0 6px 25px rgb(85 85 85 / 0.6); }
  #adminPage { display: none; max-width: 480px; margin: 30px auto 50px; background: white; padding: 30px 30px 40px; box-shadow: 0 10px 30px rgb(0 0 0 / 0.1); border-radius: 16px; transition: box-shadow 0.3s ease; }
  #adminPage:focus-within { box-shadow: 0 14px 45px rgb(33 150 243 / 0.35); }
  #adminPage h2 { margin-top: 0; color: #2196f3; font-weight: 700; font-size: 1.6rem; margin-bottom: 25px; user-select: none; }
  @media (max-width: 640px) {
    .container, #adminPage { margin: 20px 15px 40px; padding: 20px; }
    button { width: 100%; margin-top: 15px; }
  }
</style>
</head>
<body>

<header>
  <div class="admin-dot" onclick="openAdmin()"></div>
  <h1>اسعار الشاشات والبطاريات وقطع الغيار \ محل البارون<br>07719813722 - 07507946930</h1>
</header>

<div class="container" id="customerPage">
  <label for="brandSelect">اختر الشركة:</label>
  <select id="brandSelect" onchange="onBrandOrTypeChange()">
    <option value="" disabled selected>اختر الشركة</option>
    <option>ايفون</option>
    <option>سامسونج</option>
    <option>شاومي</option>
    <option>هواوي- هونر</option>
    <option>اوبو</option>
    <option>فيفو</option>
    <option>انفنكس- تكنو</option>
    <option>0ريلمي</option>
    <option>آيتل</option>
    <option>ريلمي</option>
    <option>##</option>
  </select>

  <label for="typeSelect">اختر النوع:</label>
  <select id="typeSelect" onchange="onBrandOrTypeChange()" disabled>
    <option value="" disabled selected>اختر النوع</option>
    <option>شاشة</option>
    <option>بطارية</option>
    <option>قطع غيار</option>
  </select>

  <input type="text" id="searchInput" placeholder="ابحث هنا..." oninput="renderList()" style="display:none; margin-bottom: 15px;">
  <div class="list" id="productsList"></div>
</div>

<div id="adminPage">
  <h2>لوحة التحكم</h2>
  <select id="adminBrand">
    <option disabled selected>اختر الشركة</option>
    <option>ايفون</option>
    <option>سامسونج</option>
    <option>شاومي</option>
    <option>هواوي- هونر</option>
    <option>اوبو</option>
    <option>فيفو</option>
    <option>انفنكس- تكنو</option>
    <option>0ريلمي</option>
    <option>آيتل</option>
    <option>##</option>
    <option>ريلمي</option>
  </select>
  <input type="text" id="adminName" placeholder="اسم القطعة أو الموديل" />
  <input type="number" id="adminPrice" placeholder="السعر" />
  <select id="adminType">
    <option disabled selected>اختر النوع</option>
    <option>شاشة</option>
    <option>بطارية</option>
    <option>قطع غيار</option>
  </select>
  <button onclick="addItem()">إضافة</button>
  <button class="btn-back" onclick="closeAdmin()">العودة</button>
  <div id="adminList" style="margin-top: 25px; max-height: 350px; overflow-y: auto; border-top: 2px solid #2196f3; padding-top: 15px;"></div>
</div>

<script>
  const apiUrl = "https://script.google.com/macros/s/AKfycbzNVNGfghyzyoy5Vt77SAWNXj1I3tTdv3YMWaq4gfr2Uw2wUBLGQs159ZW4Gyzt-b3ppg/exec";
  let allData = [];

  async function fetchData() {
    const res = await fetch(apiUrl);
    allData = await res.json();
    document.getElementById('typeSelect').disabled = false;
    renderAdminList();
  }

  function onBrandOrTypeChange() {
    const brand = document.getElementById('brandSelect').value;
    const type = document.getElementById('typeSelect').value;
    const searchInput = document.getElementById('searchInput');
    const productsList = document.getElementById('productsList');

    if (brand && type) {
      searchInput.style.display = 'block';
      renderList();
    } else {
      searchInput.style.display = 'none';
      productsList.innerHTML = '';
    }
  }

  function clean(str) {
    return str.replace(/[\u200E\u200F\u00A0]/g, '').trim().toLowerCase();
  }

  function renderList() {
    const brand = document.getElementById('brandSelect').value;
    const type = document.getElementById('typeSelect').value;
    const query = document.getElementById('searchInput').value.toLowerCase();

    const productsList = document.getElementById('productsList');
    productsList.innerHTML = '';

    if (!brand || !type) return;

    const filtered = allData.slice(1).filter(row => {
      if (row.length < 4) return false;
      const [name, price, itemType, itemBrand] = row;
      return clean(itemBrand) === clean(brand) &&
             clean(itemType) === clean(type) &&
             clean(name).includes(clean(query));
    });

    if (filtered.length === 0) {
      productsList.innerHTML = '<p style="padding:10px; color:#888;">لا توجد نتائج</p>';
      return;
    }

    filtered.forEach(row => {
      const [name, price] = row;
      const div = document.createElement('div');
      div.className = 'item';
      div.innerHTML = `<div class="name">${name}</div><div class="price">${formatPrice(price)}</div>`;
      productsList.appendChild(div);
    });
  }

  function formatPrice(price) {
    return Number(price).toLocaleString('en-US') + ' IQD';
  }

  async function addItem() {
    const brand = document.getElementById('adminBrand').value;
    const name = document.getElementById('adminName').value.trim();
    const price = document.getElementById('adminPrice').value.trim();
    const type = document.getElementById('adminType').value;

    if (!brand || !name || !price || !type) {
      alert('يرجى ملء جميع الحقول');
      return;
    }

    await fetch(apiUrl, {
      method: 'POST',
      body: JSON.stringify({ brand, name, price, type, action: "add" }),
    });

    alert('تمت الإضافة بنجاح');
    document.getElementById('adminBrand').selectedIndex = 0;
    document.getElementById('adminName').value = '';
    document.getElementById('adminPrice').value = '';
    document.getElementById('adminType').selectedIndex = 0;

    fetchData();
  }

  function openAdmin() {
    const code = prompt('أدخل رمز الدخول:');
    if (code === '200300') {
      document.getElementById('customerPage').style.display = 'none';
      document.getElementById('adminPage').style.display = 'block';
      renderAdminList();
    } else {
      alert('رمز خاطئ');
    }
  }

  function closeAdmin() {
    document.getElementById('adminPage').style.display = 'none';
    document.getElementById('customerPage').style.display = 'block';
    fetchData();
  }

  function renderAdminList() {
    const adminList = document.getElementById('adminList');
    if (!adminList) return;
    adminList.innerHTML = '';

    if (allData.length <= 1) {
      adminList.innerHTML = '<p>لا توجد بيانات للعرض</p>';
      return;
    }

    const headerRow = document.createElement('div');
    headerRow.style.display = 'flex';
    headerRow.style.justifyContent = 'space-between';
    headerRow.style.fontWeight = '700';
    headerRow.style.padding = '10px 0';
    headerRow.style.borderBottom = '2px solid #2196f3';
    headerRow.innerHTML = `
      <div style="flex:2;">الاسم</div>
      <div style="flex:1; text-align:center;">السعر</div>
      <div style="flex:1; text-align:center;">النوع</div>
      <div style="flex:1; text-align:center;">الشركة</div>
      <div style="flex:1; text-align:center;">تعديل</div>
      <div style="flex:1; text-align:center;">حذف</div>
    `;
    adminList.appendChild(headerRow);

    allData.slice(1).forEach((row, i) => {
      if (row.length < 4) return;
      const [name, price, type, brand] = row;

      const rowDiv = document.createElement('div');
      rowDiv.style.display = 'flex';
      rowDiv.style.justifyContent = 'space-between';
      rowDiv.style.alignItems = 'center';
      rowDiv.style.padding = '8px 0';
      rowDiv.style.borderBottom = '1px solid #ddd';

      rowDiv.innerHTML = `
        <div style="flex:2;">${name}</div>
        <div style="flex:1; text-align:center;">${formatPrice(price)}</div>
        <div style="flex:1; text-align:center;">${type}</div>
        <div style="flex:1; text-align:center;">${brand}</div>
        <div style="flex:1; text-align:center;">
          <button onclick="editItem(${i})" style="padding: 6px 12px; font-size: 14px;">تعديل</button>
        </div>
        <div style="flex:1; text-align:center;">
          <button onclick="deleteItem(${i})" style="padding: 6px 12px; font-size: 14px; background:#e53935;">حذف</button>
        </div>
      `;

      adminList.appendChild(rowDiv);
    });
  }

  async function editItem(index) {
    const item = allData[index + 1];
    if (!item) return;
    const [name, oldPrice, type, brand] = item;

    const newPrice = prompt(`تعديل السعر لـ "${name}" (السعر الحالي: ${oldPrice}):`, oldPrice);
    if (newPrice === null) return;

    if (newPrice.trim() === "" || isNaN(newPrice)) {
      alert("يرجى إدخال سعر صالح");
      return;
    }

    await fetch(apiUrl, {
      method: "POST",
      body: JSON.stringify({ action: "edit", brand, name, price: newPrice, type }),
    });

    alert("تم تعديل السعر بنجاح");
    fetchData();
  }

  async function deleteItem(index) {
    const item = allData[index + 1];
    if (!item) return;
    const [name, price, type, brand] = item;

    if (!confirm(`هل أنت متأكد من حذف "${name}"؟`)) return;

    await fetch(apiUrl, {
      method: "POST",
      body: JSON.stringify({ action: "delete", brand, name, price, type }),
    });

    alert("تم حذف العنصر بنجاح");
    fetchData();
  }

  document.addEventListener('copy', e => e.preventDefault());
  document.addEventListener('cut', e => e.preventDefault());
  document.addEventListener('paste', e => e.preventDefault());
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if ((e.ctrlKey && ['c', 'x', 'v', 'u'].includes(e.key.toLowerCase())) || e.key === 'F12') {
      e.preventDefault();
    }
  });

  window.onload = fetchData;
</script>

</body>
</html>